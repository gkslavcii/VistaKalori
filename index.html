<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#e85d3a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Vista Kalori">
<meta name="description" content="Vista Kalori - G√ºnl√ºk kalori ve beslenme takip uygulamasƒ±">
<link rel="manifest" id="manifestLink">
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23e85d3a' width='100' height='100' rx='20'/><text x='50' y='68' text-anchor='middle' font-size='55'>üçΩ</text></svg>">
<title>Vista Kalori</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
<style>
:root{--bg:#faf8f4;--card:#fff;--text:#1a1a1a;--text2:#6b6b6b;--accent:#e85d3a;--accent2:#ff7a54;--green:#2daa6e;--green-light:#e8f7ef;--blue:#3a8fe8;--blue-light:#e8f0fb;--orange:#e8a23a;--orange-light:#fdf3e0;--red:#e84d4d;--red-light:#fde8e8;--purple:#8b5cf6;--purple-light:#f0ebfe;--border:#eae6df;--shadow:0 2px 16px rgba(0,0,0,.06);--shadow-lg:0 8px 32px rgba(0,0,0,.1);--radius:16px;--radius-sm:10px}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);max-width:430px;margin:0 auto;min-height:100vh;min-height:100dvh;position:relative;overflow-x:hidden;-webkit-font-smoothing:antialiased}

.header{padding:16px 20px 18px;background:linear-gradient(145deg,var(--accent),#c9421e);color:#fff;position:relative;overflow:hidden}
.header::before{content:'';position:absolute;top:-60px;right:-30px;width:160px;height:160px;border-radius:50%;background:rgba(255,255,255,.06)}
.header::after{content:'';position:absolute;bottom:-40px;left:-20px;width:100px;height:100px;border-radius:50%;background:rgba(255,255,255,.04)}
.header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;position:relative;z-index:2}
.header h1{font-family:'Playfair Display',serif;font-size:1.45rem;font-weight:800;letter-spacing:-.5px}
.header .date{font-size:.78rem;opacity:.8;font-weight:500;margin-top:1px}
.header .icon-btn{background:rgba(255,255,255,.14);border:none;color:#fff;width:36px;height:36px;border-radius:10px;font-size:1.05rem;cursor:pointer;display:flex;align-items:center;justify-content:center}

.calorie-ring-section{display:flex;align-items:center;gap:18px;position:relative;z-index:2}
.ring-container{position:relative;width:105px;height:105px;flex-shrink:0}
.ring-container svg{transform:rotate(-90deg)}
.ring-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
.ring-text .cal-num{font-family:'Playfair Display',serif;font-size:1.5rem;font-weight:800;display:block;line-height:1}
.ring-text .cal-label{font-size:.6rem;opacity:.75;text-transform:uppercase;letter-spacing:1px;margin-top:2px}
.macro-summary{flex:1;display:flex;flex-direction:column;gap:9px}
.macro-row{display:flex;align-items:center;gap:7px}
.macro-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.macro-row .macro-name{font-size:.74rem;opacity:.85;width:50px}
.macro-bar-bg{flex:1;height:5px;background:rgba(255,255,255,.13);border-radius:3px;overflow:hidden}
.macro-bar-fill{height:100%;border-radius:3px;transition:width .6s cubic-bezier(.25,1,.5,1)}
.macro-row .macro-val{font-size:.7rem;font-weight:700;min-width:36px;text-align:right;opacity:.9}

.date-nav{display:flex;align-items:center;justify-content:center;gap:16px;padding:12px 16px;background:var(--card);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:20}
.date-nav button{background:var(--bg);border:1px solid var(--border);width:32px;height:32px;border-radius:8px;font-size:.9rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
.date-nav .current-date{font-weight:700;font-size:.88rem;min-width:140px;text-align:center}
.date-nav .today-btn{font-family:'DM Sans';font-size:.72rem;font-weight:700;color:var(--accent);background:none;border:1px solid var(--accent);border-radius:6px;padding:4px 10px;cursor:pointer;width:auto;height:auto;display:none}
.date-nav .today-btn.show{display:inline-flex}

.content{padding:14px 16px 100px}

.meal-section{margin-bottom:14px;animation:fadeUp .35s ease both}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.meal-section:nth-child(2){animation-delay:.04s}.meal-section:nth-child(3){animation-delay:.08s}.meal-section:nth-child(4){animation-delay:.12s}
.meal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.meal-title{display:flex;align-items:center;gap:8px;font-weight:700;font-size:.95rem}
.meal-title .meal-icon{width:30px;height:30px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:1rem}
.meal-kcal{font-size:.8rem;color:var(--text2);font-weight:600}
.meal-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;border:1px solid var(--border)}
.food-item{display:flex;align-items:center;padding:11px 12px;gap:10px;border-bottom:1px solid #f5f2ed}
.food-item:last-of-type{border-bottom:none}
.food-emoji{width:38px;height:38px;border-radius:10px;background:var(--bg);display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0}
.food-info{flex:1;min-width:0}
.food-name{font-weight:600;font-size:.84rem;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.food-macros{font-size:.68rem;color:var(--text2);display:flex;gap:5px}
.food-cal{font-weight:700;font-size:.88rem;color:var(--accent);flex-shrink:0;margin-right:4px}
.food-delete{background:none;border:none;color:#ccc;font-size:1rem;cursor:pointer;padding:6px;border-radius:8px;flex-shrink:0}
.food-delete:active{color:var(--red);background:var(--red-light)}
.add-food-btn{display:flex;align-items:center;justify-content:center;gap:5px;padding:11px;color:var(--accent);font-weight:600;font-size:.82rem;cursor:pointer;border-top:1px dashed var(--border)}
.empty-meal{padding:20px;text-align:center;color:var(--text2);font-size:.82rem}

.stat-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid var(--border);padding:16px;margin-bottom:12px;animation:fadeUp .35s ease both}
.stat-card h3{font-size:.86rem;font-weight:700;margin-bottom:14px;display:flex;align-items:center;gap:7px}
.week-chart{display:flex;align-items:flex-end;gap:5px;height:110px;padding-top:8px}
.week-bar{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;height:100%;justify-content:flex-end}
.week-bar .bar{width:100%;border-radius:5px 5px 3px 3px;min-height:3px;transition:height .5s ease}
.week-bar .bar.over{background:linear-gradient(to top,var(--red),#ff7070)}.week-bar .bar.under{background:linear-gradient(to top,var(--green),#5dd9a0)}.week-bar .bar.today{background:linear-gradient(to top,var(--accent),var(--accent2))}.week-bar .bar.empty{background:#eee}
.week-bar .day-label{font-size:.65rem;color:var(--text2);font-weight:600}.week-bar .cal-label{font-size:.6rem;font-weight:700}
.target-line{width:100%;border-top:2px dashed rgba(0,0,0,.1);position:relative;margin-bottom:8px}
.target-line span{position:absolute;right:0;top:-15px;font-size:.62rem;color:var(--text2);font-weight:600}
.macro-detail-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
.macro-detail-item{text-align:center;padding:10px 6px;border-radius:var(--radius-sm)}
.macro-detail-item .macro-circle{width:48px;height:48px;border-radius:50%;margin:0 auto 6px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:.82rem}
.macro-detail-item .md-name{font-size:.68rem;color:var(--text2);font-weight:600}
.macro-detail-item .md-val{font-size:.78rem;font-weight:700;margin-top:2px}

.profile-card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid var(--border);padding:18px;margin-bottom:12px;animation:fadeUp .35s ease both}
.profile-card h3{font-size:.9rem;font-weight:700;margin-bottom:14px}
.profile-field{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid #f5f2ed}
.profile-field:last-of-type{border-bottom:none}
.profile-field label{font-size:.82rem;color:var(--text2);font-weight:500}
.profile-field input,.profile-field select{font-family:'DM Sans';font-size:.85rem;font-weight:600;border:1.5px solid var(--border);border-radius:8px;padding:7px 10px;width:135px;text-align:right;background:var(--bg);color:var(--text);outline:none}
.profile-field input:focus,.profile-field select:focus{border-color:var(--accent)}
.calc-btn{width:100%;padding:13px;background:linear-gradient(135deg,var(--accent),#c9421e);color:#fff;border:none;border-radius:var(--radius-sm);font-family:'DM Sans';font-size:.9rem;font-weight:700;cursor:pointer;margin-top:6px;box-shadow:0 4px 15px rgba(232,93,58,.25)}
.calc-btn:active{transform:scale(.98)}
.calorie-result{text-align:center;padding:14px;background:linear-gradient(135deg,#fff8f4,#fdf0ea);border-radius:var(--radius-sm);margin-top:12px;display:none}
.calorie-result.show{display:block;animation:fadeUp .3s ease}
.calorie-result .big-num{font-family:'Playfair Display',serif;font-size:2.2rem;font-weight:800;color:var(--accent)}
.calorie-result .result-label{font-size:.76rem;color:var(--text2);margin-top:2px}

.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.45);z-index:100;display:none;align-items:flex-end;justify-content:center;backdrop-filter:blur(3px)}
.modal-overlay.show{display:flex}
.modal{background:var(--card);border-radius:22px 22px 0 0;width:100%;max-width:430px;max-height:85vh;overflow-y:auto;padding:16px 18px 24px;animation:slideUp .3s cubic-bezier(.25,1,.5,1)}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.modal-handle{width:36px;height:4px;background:#ddd;border-radius:2px;margin:0 auto 14px}
.modal h2{font-size:1.05rem;font-weight:700;margin-bottom:14px}
.search-box{width:100%;padding:11px 14px;border:1.5px solid var(--border);border-radius:var(--radius-sm);font-family:'DM Sans';font-size:.88rem;outline:none;background:var(--bg);margin-bottom:10px}
.search-box:focus{border-color:var(--accent)}

.source-tabs{display:flex;gap:0;margin-bottom:10px;background:var(--bg);border-radius:10px;padding:3px;border:1px solid var(--border)}
.source-tab{flex:1;padding:8px 6px;text-align:center;font-size:.76rem;font-weight:700;border-radius:8px;cursor:pointer;border:none;background:none;font-family:'DM Sans';color:var(--text2);transition:all .2s}
.source-tab.active{background:var(--card);color:var(--accent);box-shadow:0 1px 4px rgba(0,0,0,.08)}

.cat-pills{display:flex;gap:6px;margin-bottom:10px;overflow-x:auto;padding-bottom:4px;-webkit-overflow-scrolling:touch}
.cat-pill{font-family:'DM Sans';font-size:.72rem;font-weight:600;padding:6px 11px;border-radius:20px;border:1.5px solid var(--border);background:#fff;cursor:pointer;white-space:nowrap;color:var(--text2)}
.cat-pill.active{background:var(--accent);color:#fff;border-color:var(--accent)}

.food-db-list{max-height:240px;overflow-y:auto}
.food-db-item{display:flex;align-items:center;padding:9px 10px;gap:9px;border-radius:var(--radius-sm);cursor:pointer;margin-bottom:1px}
.food-db-item:active{background:#faf6f0}
.food-db-item .fdb-emoji{font-size:1.2rem;flex-shrink:0}
.food-db-item .fdb-info{flex:1;min-width:0}
.food-db-item .fdb-name{font-weight:600;font-size:.82rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.food-db-item .fdb-detail{font-size:.68rem;color:var(--text2)}
.food-db-item .fdb-cal{font-weight:700;font-size:.82rem;color:var(--accent);flex-shrink:0}

.api-status{text-align:center;padding:16px;font-size:.82rem;color:var(--text2)}
.api-status .spinner{display:inline-block;width:18px;height:18px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .6s linear infinite;margin-bottom:6px}
@keyframes spin{to{transform:rotate(360deg)}}

.divider{display:flex;align-items:center;gap:10px;margin:14px 0;color:var(--text2);font-size:.76rem;font-weight:600}
.divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border)}
.custom-form{display:flex;flex-direction:column;gap:8px}
.custom-form .form-row{display:flex;gap:7px}
.custom-form input{font-family:'DM Sans';font-size:.82rem;border:1.5px solid var(--border);border-radius:8px;padding:9px 10px;outline:none;background:var(--bg);color:var(--text);flex:1;min-width:0}
.custom-form input:focus{border-color:var(--accent)}
.custom-form .submit-btn{padding:11px;background:var(--green);color:#fff;border:none;border-radius:var(--radius-sm);font-family:'DM Sans';font-weight:700;font-size:.85rem;cursor:pointer}
.modal-cancel{background:none;border:none;color:var(--text2);font-family:'DM Sans';font-size:.82rem;font-weight:600;cursor:pointer;padding:10px;width:100%;margin-top:8px}

.portion-row{display:flex;align-items:center;gap:8px;margin:10px 0;padding:10px 12px;background:var(--bg);border-radius:var(--radius-sm)}
.portion-row label{font-size:.82rem;font-weight:600;color:var(--text2)}
.portion-row input{font-family:'DM Sans';font-size:.9rem;font-weight:700;border:1.5px solid var(--border);border-radius:8px;padding:7px 10px;width:80px;text-align:center;background:#fff;color:var(--text);outline:none}
.portion-row .unit{font-size:.82rem;font-weight:600}
.portion-preview{display:flex;justify-content:space-around;padding:8px 0;font-size:.78rem;color:var(--text2);font-weight:600}
.portion-preview span{display:flex;flex-direction:column;align-items:center;gap:2px}
.portion-preview .pv-val{font-weight:800;color:var(--text);font-size:.88rem}

.bottom-nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:430px;background:var(--card);border-top:1px solid var(--border);display:flex;padding:6px 0 max(10px,env(safe-area-inset-bottom));z-index:50;box-shadow:0 -4px 20px rgba(0,0,0,.04)}
.nav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px;cursor:pointer;border:none;background:none;font-family:'DM Sans'}
.nav-item .nav-icon{font-size:1.25rem;line-height:1;transition:transform .2s}
.nav-item .nav-label{font-size:.62rem;font-weight:600;color:var(--text2);transition:color .2s}
.nav-item.active .nav-label{color:var(--accent)}.nav-item.active .nav-icon{transform:scale(1.15)}

.toast{position:fixed;top:16px;left:50%;transform:translateX(-50%) translateY(-80px);background:#1a1a1a;color:#fff;padding:10px 18px;border-radius:10px;font-size:.82rem;font-weight:600;z-index:200;transition:transform .3s cubic-bezier(.25,1,.5,1);box-shadow:var(--shadow-lg);max-width:85%;text-align:center;white-space:nowrap}
.toast.show{transform:translateX(-50%) translateY(0)}

.page{display:none}.page.active{display:block}

.db-count{font-size:.68rem;color:var(--text2);text-align:center;padding:6px 0;font-weight:600}
</style>
</head>
<body>

<div class="header">
  <div class="header-top">
    <div><h1>üçΩÔ∏è Vista Kalori</h1><div class="date" id="todayDate"></div></div>
    <button class="icon-btn" onclick="switchTab('profil')">‚öôÔ∏è</button>
  </div>
  <div class="calorie-ring-section">
    <div class="ring-container">
      <svg width="105" height="105" viewBox="0 0 105 105">
        <circle cx="52.5" cy="52.5" r="44" fill="none" stroke="rgba(255,255,255,.12)" stroke-width="9"/>
        <circle cx="52.5" cy="52.5" r="44" fill="none" stroke="white" stroke-width="9" stroke-dasharray="276.5" stroke-dashoffset="276.5" stroke-linecap="round" id="calRing"/>
      </svg>
      <div class="ring-text"><span class="cal-num" id="calRemain">2200</span><span class="cal-label">kalan</span></div>
    </div>
    <div class="macro-summary">
      <div class="macro-row"><div class="macro-dot" style="background:#ff7a7a"></div><span class="macro-name">Protein</span><div class="macro-bar-bg"><div class="macro-bar-fill" id="protBar" style="width:0%;background:#ff7a7a"></div></div><span class="macro-val" id="protVal">0g</span></div>
      <div class="macro-row"><div class="macro-dot" style="background:#ffcc55"></div><span class="macro-name">Karb</span><div class="macro-bar-bg"><div class="macro-bar-fill" id="carbBar" style="width:0%;background:#ffcc55"></div></div><span class="macro-val" id="carbVal">0g</span></div>
      <div class="macro-row"><div class="macro-dot" style="background:#77bbff"></div><span class="macro-name">Yaƒü</span><div class="macro-bar-bg"><div class="macro-bar-fill" id="fatBar" style="width:0%;background:#77bbff"></div></div><span class="macro-val" id="fatVal">0g</span></div>
    </div>
  </div>
</div>

<div class="date-nav">
  <button onclick="changeDate(-1)">‚óÄ</button>
  <span class="current-date" id="navDate">Bug√ºn</span>
  <button onclick="changeDate(1)">‚ñ∂</button>
  <button class="today-btn" id="todayBtn" onclick="goToday()">Bug√ºn</button>
</div>

<div class="toast" id="toast"></div>

<div class="page active" id="page-gunluk"><div class="content" id="mealsContainer"></div></div>
<div class="page" id="page-istatistik"><div class="content" id="statsContainer"></div></div>
<div class="page" id="page-profil">
  <div class="content">
    <div class="profile-card">
      <h3>üë§ Ki≈üisel Bilgiler</h3>
      <div class="profile-field"><label>Cinsiyet</label><select id="pGender" onchange="saveProfile()"><option value="male">Erkek</option><option value="female">Kadƒ±n</option></select></div>
      <div class="profile-field"><label>Ya≈ü</label><input type="number" id="pAge" value="25" min="10" max="100" onchange="saveProfile()"></div>
      <div class="profile-field"><label>Boy (cm)</label><input type="number" id="pHeight" value="175" min="100" max="250" onchange="saveProfile()"></div>
      <div class="profile-field"><label>Kilo (kg)</label><input type="number" id="pWeight" value="75" min="30" max="300" onchange="saveProfile()"></div>
      <div class="profile-field"><label>Aktivite</label><select id="pActivity" onchange="saveProfile()"><option value="1.2">Hareketsiz</option><option value="1.375" selected>Az hareketli</option><option value="1.55">Orta aktif</option><option value="1.725">√áok aktif</option><option value="1.9">Ekstra aktif</option></select></div>
      <div class="profile-field"><label>Hedef</label><select id="pGoal" onchange="saveProfile()"><option value="-500">Kilo vermek</option><option value="0" selected>Korumak</option><option value="300">Kilo almak</option></select></div>
      <button class="calc-btn" onclick="calculateTDEE()">üî¢ Kalori ƒ∞htiyacƒ±nƒ± Hesapla</button>
      <div class="calorie-result" id="calResult"><div class="big-num" id="tdeeNum">2200</div><div class="result-label">G√ºnl√ºk Kalori Hedefiniz (kcal)</div></div>
    </div>
    <div class="profile-card" style="animation-delay:.05s">
      <h3>üì¶ Veri Y√∂netimi</h3>
      <div class="profile-field"><label>T√ºm verileri sƒ±fƒ±rla</label><button style="font-family:'DM Sans';font-size:.82rem;font-weight:600;padding:7px 14px;border:1.5px solid var(--red);color:var(--red);background:#fff;border-radius:8px;cursor:pointer" onclick="resetAllData()">üóëÔ∏è Sƒ±fƒ±rla</button></div>
    </div>
    <div class="profile-card" style="animation-delay:.1s">
      <h3>‚ÑπÔ∏è Hakkƒ±nda</h3>
      <p style="font-size:.78rem;color:var(--text2);line-height:1.6">Vista Kalori v2.0<br>300+ T√ºrk yemeƒüi veritabanƒ± + USDA API aramasƒ±<br>√ñƒü√ºn bazlƒ± kalori ve makro takibi<br><br>üîú Su takibi, tarif √∂nerileri, widget desteƒüi</p>
    </div>
  </div>
</div>

<div class="bottom-nav">
  <button class="nav-item active" onclick="switchTab('gunluk')" id="nav-gunluk"><span class="nav-icon">üçΩÔ∏è</span><span class="nav-label">G√ºnl√ºk</span></button>
  <button class="nav-item" onclick="switchTab('istatistik')" id="nav-istatistik"><span class="nav-icon">üìä</span><span class="nav-label">ƒ∞statistik</span></button>
  <button class="nav-item" onclick="switchTab('profil')" id="nav-profil"><span class="nav-icon">üë§</span><span class="nav-label">Profil</span></button>
</div>

<!-- Add Food Modal -->
<div class="modal-overlay" id="addFoodModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <h2 id="modalTitle">üçΩÔ∏è Yemek Ekle</h2>
    <input type="text" class="search-box" placeholder="üîç Yemek ara..." id="foodSearch" oninput="handleSearch()">
    <div class="source-tabs">
      <button class="source-tab active" onclick="switchSource('local')">üáπüá∑ T√ºrk Yemekleri</button>
      <button class="source-tab" onclick="switchSource('api')">üåç Ara</button>
      <button class="source-tab" onclick="switchSource('custom')">‚úèÔ∏è Ekle</button>
    </div>
    <div id="localPanel">
      <div class="cat-pills" id="catPills"></div>
      <div class="food-db-list" id="foodDbList"></div>
      <div class="db-count" id="dbCount"></div>
    </div>
    <div id="apiPanel" style="display:none">
      <div class="api-status" id="apiStatus">üåç Yemek adƒ± yazƒ±p arayƒ±n</div>
      <div class="food-db-list" id="apiResults"></div>
    </div>
    <div id="customPanel" style="display:none">
      <div class="custom-form">
        <input type="text" placeholder="Yemek adƒ±" id="customName">
        <div class="form-row"><input type="number" placeholder="Kalori (kcal)" id="customCal"><input type="number" placeholder="Porsiyon (g)" id="customPortion" value="100"></div>
        <div class="form-row"><input type="number" placeholder="Protein (g)" id="customProt"><input type="number" placeholder="Karb (g)" id="customCarb"><input type="number" placeholder="Yaƒü (g)" id="customFat"></div>
        <button class="submit-btn" onclick="addCustomFood()">‚úÖ Ekle</button>
      </div>
    </div>
    <button class="modal-cancel" onclick="closeModal()">ƒ∞ptal</button>
  </div>
</div>

<!-- Portion Modal -->
<div class="modal-overlay" id="portionModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <h2 id="portionTitle">Porsiyon Ayarla</h2>
    <div style="display:flex;align-items:center;gap:12px;padding:10px 0">
      <span style="font-size:2rem" id="portionEmoji"></span>
      <div><div style="font-weight:700;font-size:.92rem" id="portionFoodName"></div><div style="font-size:.75rem;color:var(--text2)" id="portionFoodBase"></div></div>
    </div>
    <div class="portion-row"><label>Miktar</label><input type="number" id="portionInput" value="100" min="1" oninput="updatePortionPreview()"><span class="unit">gram</span></div>
    <div class="portion-preview" id="portionPreview"></div>
    <button class="submit-btn" style="width:100%;margin-top:8px;padding:12px;background:var(--green);color:#fff;border:none;border-radius:10px;font-family:'DM Sans';font-weight:700;font-size:.88rem;cursor:pointer" onclick="confirmPortion()">‚úÖ Ekle</button>
    <button class="modal-cancel" onclick="closePortionModal()">ƒ∞ptal</button>
  </div>
</div>

<script>
// =============================================
// COMPREHENSIVE TURKISH FOOD DATABASE (300+)
// Values per 100g
// =============================================
const FOOD_DB = [
// ‚îÄ‚îÄ KAHVALTILIKLAR ‚îÄ‚îÄ
{name:'Ha≈ülanmƒ±≈ü Yumurta',emoji:'ü•ö',cal:155,prot:13,carb:1,fat:11,cat:'kahvalti'},
{name:'Sahanda Yumurta',emoji:'üç≥',cal:196,prot:14,carb:1,fat:15,cat:'kahvalti'},
{name:'Sucuklu Yumurta',emoji:'üç≥',cal:200,prot:14,carb:1,fat:16,cat:'kahvalti'},
{name:'Menemen',emoji:'üç≥',cal:70,prot:4,carb:3,fat:5,cat:'kahvalti'},
{name:'Omlet (sade)',emoji:'üç≥',cal:154,prot:11,carb:0,fat:12,cat:'kahvalti'},
{name:'Beyaz Peynir',emoji:'üßÄ',cal:264,prot:17,carb:1,fat:21,cat:'kahvalti'},
{name:'Ka≈üar Peyniri',emoji:'üßÄ',cal:313,prot:25,carb:1,fat:23,cat:'kahvalti'},
{name:'Tulum Peyniri',emoji:'üßÄ',cal:350,prot:22,carb:1,fat:29,cat:'kahvalti'},
{name:'Lor Peyniri',emoji:'üßÄ',cal:98,prot:11,carb:3,fat:4,cat:'kahvalti'},
{name:'√á√∂kelek',emoji:'üßÄ',cal:72,prot:11,carb:2,fat:2,cat:'kahvalti'},
{name:'Ye≈üil Zeytin',emoji:'ü´í',cal:145,prot:1,carb:4,fat:15,cat:'kahvalti'},
{name:'Siyah Zeytin',emoji:'ü´í',cal:115,prot:1,carb:6,fat:11,cat:'kahvalti'},
{name:'Domates',emoji:'üçÖ',cal:18,prot:1,carb:4,fat:0,cat:'kahvalti'},
{name:'Salatalƒ±k',emoji:'ü•í',cal:15,prot:1,carb:4,fat:0,cat:'kahvalti'},
{name:'Beyaz Ekmek',emoji:'üçû',cal:265,prot:9,carb:49,fat:3,cat:'kahvalti'},
{name:'Tam Buƒüday Ekmeƒüi',emoji:'üçû',cal:247,prot:13,carb:41,fat:3,cat:'kahvalti'},
{name:'√áavdar Ekmeƒüi',emoji:'üçû',cal:259,prot:9,carb:48,fat:3,cat:'kahvalti'},
{name:'Simit',emoji:'ü•Ø',cal:233,prot:8,carb:42,fat:4,cat:'kahvalti'},
{name:'Poƒüa√ßa',emoji:'ü•ê',cal:310,prot:6,carb:35,fat:16,cat:'kahvalti'},
{name:'A√ßma',emoji:'ü•ê',cal:320,prot:7,carb:37,fat:16,cat:'kahvalti'},
{name:'B√∂rek (peynirli)',emoji:'ü•ß',cal:260,prot:8,carb:25,fat:14,cat:'kahvalti'},
{name:'Su B√∂reƒüi',emoji:'ü•ß',cal:220,prot:7,carb:22,fat:12,cat:'kahvalti'},
{name:'G√∂zleme (peynirli)',emoji:'ü´ì',cal:195,prot:7,carb:22,fat:9,cat:'kahvalti'},
{name:'G√∂zleme (patatesli)',emoji:'ü´ì',cal:180,prot:4,carb:26,fat:7,cat:'kahvalti'},
{name:'Bal',emoji:'üçØ',cal:304,prot:0,carb:82,fat:0,cat:'kahvalti'},
{name:'Tereyaƒüƒ±',emoji:'üßà',cal:717,prot:1,carb:0,fat:81,cat:'kahvalti'},
{name:'Tahin',emoji:'ü•ú',cal:595,prot:17,carb:21,fat:54,cat:'kahvalti'},
{name:'Pekmez (√ºz√ºm)',emoji:'üçá',cal:293,prot:1,carb:72,fat:0,cat:'kahvalti'},
{name:'Kaymak',emoji:'ü•õ',cal:292,prot:2,carb:3,fat:30,cat:'kahvalti'},
{name:'Re√ßel (karƒ±≈üƒ±k)',emoji:'üçì',cal:250,prot:0,carb:63,fat:0,cat:'kahvalti'},
{name:'Pi≈üi',emoji:'üç©',cal:280,prot:5,carb:32,fat:15,cat:'kahvalti'},
{name:'Bazlama',emoji:'ü´ì',cal:240,prot:7,carb:45,fat:3,cat:'kahvalti'},

// ‚îÄ‚îÄ √áORBALAR ‚îÄ‚îÄ
{name:'Mercimek √áorbasƒ±',emoji:'üç≤',cal:48,prot:3,carb:7,fat:1,cat:'corba'},
{name:'Ezogelin √áorbasƒ±',emoji:'üç≤',cal:52,prot:3,carb:8,fat:1,cat:'corba'},
{name:'Domates √áorbasƒ±',emoji:'üç≤',cal:35,prot:1,carb:6,fat:1,cat:'corba'},
{name:'Tarhana √áorbasƒ±',emoji:'üç≤',cal:45,prot:2,carb:7,fat:1,cat:'corba'},
{name:'Yayla √áorbasƒ±',emoji:'üç≤',cal:55,prot:2,carb:5,fat:3,cat:'corba'},
{name:'Tavuk Suyu √áorbasƒ±',emoji:'üç≤',cal:30,prot:3,carb:2,fat:1,cat:'corba'},
{name:'ƒ∞≈ükembe √áorbasƒ±',emoji:'üç≤',cal:52,prot:5,carb:3,fat:2,cat:'corba'},
{name:'D√ºƒü√ºn √áorbasƒ±',emoji:'üç≤',cal:65,prot:4,carb:5,fat:3,cat:'corba'},
{name:'≈ûehriye √áorbasƒ±',emoji:'üç≤',cal:40,prot:2,carb:7,fat:0,cat:'corba'},
{name:'Pa√ßa √áorbasƒ±',emoji:'üç≤',cal:48,prot:6,carb:1,fat:2,cat:'corba'},
{name:'Mantar √áorbasƒ±',emoji:'üç≤',cal:42,prot:2,carb:4,fat:2,cat:'corba'},
{name:'S√ºzme Mercimek',emoji:'üç≤',cal:55,prot:3,carb:8,fat:1,cat:'corba'},
{name:'Lokanta Usul√º √áorba',emoji:'üç≤',cal:50,prot:2,carb:6,fat:2,cat:'corba'},

// ‚îÄ‚îÄ ET YEMEKLERƒ∞ ‚îÄ‚îÄ
{name:'Tavuk G√∂ƒüs√º (ƒ±zgara)',emoji:'üçó',cal:165,prot:31,carb:0,fat:4,cat:'et'},
{name:'Tavuk But (fƒ±rƒ±nda)',emoji:'üçó',cal:209,prot:26,carb:0,fat:11,cat:'et'},
{name:'Tavuk Kanat',emoji:'üçó',cal:203,prot:18,carb:0,fat:14,cat:'et'},
{name:'Tavuk ≈ûi≈ü',emoji:'üç¢',cal:150,prot:25,carb:2,fat:5,cat:'et'},
{name:'Adana Kebap',emoji:'ü•ô',cal:230,prot:17,carb:3,fat:17,cat:'et'},
{name:'Urfa Kebap',emoji:'ü•ô',cal:215,prot:17,carb:2,fat:16,cat:'et'},
{name:'ƒ∞skender',emoji:'ü•ô',cal:155,prot:11,carb:8,fat:9,cat:'et'},
{name:'D√∂ner (tavuk)',emoji:'ü•ô',cal:120,prot:13,carb:3,fat:6,cat:'et'},
{name:'D√∂ner (et)',emoji:'ü•ô',cal:150,prot:14,carb:4,fat:9,cat:'et'},
{name:'K√∂fte (ƒ±zgara)',emoji:'üßÜ',cal:250,prot:17,carb:10,fat:16,cat:'et'},
{name:'ƒ∞neg√∂l K√∂fte',emoji:'üßÜ',cal:235,prot:16,carb:5,fat:17,cat:'et'},
{name:'Kadƒ±nbudu K√∂fte',emoji:'üßÜ',cal:195,prot:14,carb:12,fat:10,cat:'et'},
{name:'ƒ∞zmir K√∂fte',emoji:'üßÜ',cal:180,prot:13,carb:8,fat:11,cat:'et'},
{name:'√áiƒü K√∂fte (etsiz)',emoji:'üßÜ',cal:140,prot:5,carb:25,fat:3,cat:'et'},
{name:'Kuzu Pirzola',emoji:'ü•©',cal:294,prot:25,carb:0,fat:21,cat:'et'},
{name:'Kuzu Tandƒ±r',emoji:'ü•©',cal:220,prot:22,carb:0,fat:14,cat:'et'},
{name:'Dana Biftek',emoji:'ü•©',cal:271,prot:26,carb:0,fat:18,cat:'et'},
{name:'Et Sote',emoji:'ü•©',cal:170,prot:16,carb:5,fat:9,cat:'et'},
{name:'Kavurma',emoji:'ü•©',cal:280,prot:20,carb:1,fat:22,cat:'et'},
{name:'Ciƒüer Tava',emoji:'ü•©',cal:175,prot:22,carb:5,fat:7,cat:'et'},
{name:'Lahmacun',emoji:'ü´ì',cal:180,prot:8,carb:21,fat:7,cat:'et'},
{name:'Pide (kƒ±ymalƒ±)',emoji:'ü´ì',cal:145,prot:7,carb:18,fat:5,cat:'et'},
{name:'Pide (ku≈üba≈üƒ±lƒ±)',emoji:'ü´ì',cal:155,prot:9,carb:17,fat:6,cat:'et'},
{name:'Pide (ka≈üarlƒ±)',emoji:'ü´ì',cal:170,prot:8,carb:18,fat:7,cat:'et'},
{name:'Etli Ekmek',emoji:'ü´ì',cal:165,prot:8,carb:20,fat:6,cat:'et'},
{name:'Tantuni',emoji:'üåÆ',cal:180,prot:15,carb:10,fat:9,cat:'et'},
{name:'Kokore√ß',emoji:'üåÆ',cal:195,prot:14,carb:12,fat:10,cat:'et'},
{name:'Sucuk (ƒ±zgara)',emoji:'üå≠',cal:452,prot:18,carb:2,fat:41,cat:'et'},
{name:'Pastƒ±rma',emoji:'ü•©',cal:170,prot:33,carb:1,fat:4,cat:'et'},

// ‚îÄ‚îÄ BALIK & DENƒ∞Z ‚îÄ‚îÄ
{name:'Levrek (ƒ±zgara)',emoji:'üêü',cal:97,prot:18,carb:0,fat:2,cat:'balik'},
{name:'√áipura (ƒ±zgara)',emoji:'üêü',cal:100,prot:19,carb:0,fat:2,cat:'balik'},
{name:'Somon (ƒ±zgara)',emoji:'üêü',cal:208,prot:20,carb:0,fat:13,cat:'balik'},
{name:'Hamsi (tava)',emoji:'üêü',cal:210,prot:18,carb:6,fat:12,cat:'balik'},
{name:'Hamsi Buƒüulama',emoji:'üêü',cal:130,prot:18,carb:0,fat:6,cat:'balik'},
{name:'Palamut (ƒ±zgara)',emoji:'üêü',cal:158,prot:22,carb:0,fat:7,cat:'balik'},
{name:'L√ºfer (ƒ±zgara)',emoji:'üêü',cal:124,prot:20,carb:0,fat:4,cat:'balik'},
{name:'Alabalƒ±k (ƒ±zgara)',emoji:'üêü',cal:119,prot:20,carb:0,fat:4,cat:'balik'},
{name:'Sardalya (tava)',emoji:'üêü',cal:190,prot:17,carb:5,fat:11,cat:'balik'},
{name:'Ton Balƒ±ƒüƒ± (konserve)',emoji:'üêü',cal:116,prot:26,carb:0,fat:1,cat:'balik'},
{name:'Karides (ha≈ülanmƒ±≈ü)',emoji:'ü¶ê',cal:99,prot:24,carb:0,fat:1,cat:'balik'},
{name:'Kalamar (tava)',emoji:'ü¶ë',cal:175,prot:15,carb:8,fat:9,cat:'balik'},
{name:'Midye Dolma',emoji:'üêö',cal:120,prot:6,carb:15,fat:4,cat:'balik'},
{name:'Midye Tava',emoji:'üêö',cal:200,prot:10,carb:14,fat:12,cat:'balik'},
{name:'Balƒ±k Ekmek',emoji:'ü•™',cal:160,prot:10,carb:16,fat:6,cat:'balik'},

// ‚îÄ‚îÄ SEBZE YEMEKLERƒ∞ ‚îÄ‚îÄ
{name:'Karnƒ±yarƒ±k',emoji:'üçÜ',cal:95,prot:5,carb:8,fat:5,cat:'sebze'},
{name:'ƒ∞mam Bayƒ±ldƒ±',emoji:'üçÜ',cal:70,prot:2,carb:8,fat:4,cat:'sebze'},
{name:'Patlƒ±can Musakka',emoji:'üçÜ',cal:110,prot:5,carb:9,fat:6,cat:'sebze'},
{name:'Patlƒ±can Kebabƒ±',emoji:'üçÜ',cal:120,prot:7,carb:6,fat:8,cat:'sebze'},
{name:'Zeytinyaƒülƒ± Fasulye',emoji:'ü´õ',cal:65,prot:2,carb:8,fat:3,cat:'sebze'},
{name:'Zeytinyaƒülƒ± Enginar',emoji:'üåø',cal:72,prot:2,carb:10,fat:3,cat:'sebze'},
{name:'Zeytinyaƒülƒ± Yaprak Sarma',emoji:'üåø',cal:85,prot:2,carb:12,fat:4,cat:'sebze'},
{name:'Etli Yaprak Sarma',emoji:'üåø',cal:110,prot:6,carb:10,fat:5,cat:'sebze'},
{name:'Zeytinyaƒülƒ± Dolma',emoji:'ü´ë',cal:80,prot:2,carb:12,fat:3,cat:'sebze'},
{name:'Etli Biber Dolma',emoji:'ü´ë',cal:105,prot:6,carb:10,fat:5,cat:'sebze'},
{name:'Etli Lahana Sarma',emoji:'ü•¨',cal:95,prot:6,carb:8,fat:4,cat:'sebze'},
{name:'T√ºrl√º (sebze)',emoji:'ü•ò',cal:60,prot:2,carb:8,fat:2,cat:'sebze'},
{name:'Bamya (zeytinyaƒülƒ±)',emoji:'ü•ò',cal:55,prot:2,carb:7,fat:2,cat:'sebze'},
{name:'Ispanak Yemeƒüi',emoji:'ü•¨',cal:65,prot:4,carb:5,fat:3,cat:'sebze'},
{name:'Karƒ±≈üƒ±k Salata',emoji:'ü•ó',cal:40,prot:2,carb:5,fat:2,cat:'sebze'},
{name:'√áoban Salata',emoji:'ü•ó',cal:35,prot:1,carb:5,fat:1,cat:'sebze'},
{name:'Piyaz',emoji:'ü•ó',cal:90,prot:4,carb:12,fat:3,cat:'sebze'},
{name:'Patates Salatasƒ±',emoji:'ü•ó',cal:95,prot:2,carb:14,fat:3,cat:'sebze'},
{name:'Havu√ß Tarator',emoji:'ü•ï',cal:80,prot:3,carb:8,fat:4,cat:'sebze'},
{name:'Cacƒ±k',emoji:'ü•í',cal:35,prot:2,carb:3,fat:2,cat:'sebze'},
{name:'Haydari',emoji:'ü•í',cal:80,prot:4,carb:3,fat:6,cat:'sebze'},
{name:'Acƒ±lƒ± Ezme',emoji:'üå∂Ô∏è',cal:55,prot:1,carb:6,fat:3,cat:'sebze'},
{name:'Kƒ±sƒ±r',emoji:'ü•ó',cal:120,prot:3,carb:18,fat:4,cat:'sebze'},
{name:'M√ºcver',emoji:'ü•¨',cal:150,prot:5,carb:12,fat:9,cat:'sebze'},
{name:'Menemen (sebzeli)',emoji:'üç≥',cal:75,prot:4,carb:5,fat:4,cat:'sebze'},

// ‚îÄ‚îÄ BAKLAGƒ∞LLER ‚îÄ‚îÄ
{name:'Kuru Fasulye',emoji:'ü´ò',cal:70,prot:5,carb:11,fat:1,cat:'baklagil'},
{name:'Etli Nohut',emoji:'ü´ò',cal:74,prot:6,carb:8,fat:2,cat:'baklagil'},
{name:'Nohut (ha≈ülanmƒ±≈ü)',emoji:'ü´ò',cal:164,prot:9,carb:27,fat:3,cat:'baklagil'},
{name:'Barbunya Pilaki',emoji:'ü´ò',cal:65,prot:4,carb:10,fat:1,cat:'baklagil'},
{name:'Ye≈üil Mercimek',emoji:'ü´ò',cal:116,prot:9,carb:20,fat:0,cat:'baklagil'},
{name:'Bezelye Yemeƒüi',emoji:'ü´õ',cal:62,prot:4,carb:8,fat:1,cat:'baklagil'},
{name:'Etli T√ºrl√º',emoji:'ü•ò',cal:80,prot:5,carb:7,fat:3,cat:'baklagil'},

// ‚îÄ‚îÄ Pƒ∞LAV & MAKARNA ‚îÄ‚îÄ
{name:'Pilav (tereyaƒülƒ±)',emoji:'üçö',cal:130,prot:3,carb:28,fat:0,cat:'pilav'},
{name:'Bulgur Pilavƒ±',emoji:'üçö',cal:83,prot:3,carb:19,fat:0,cat:'pilav'},
{name:'≈ûehriyeli Pilav',emoji:'üçö',cal:140,prot:3,carb:28,fat:2,cat:'pilav'},
{name:'ƒ∞√ß Pilav',emoji:'üçö',cal:155,prot:4,carb:25,fat:5,cat:'pilav'},
{name:'Nohutlu Pilav',emoji:'üçö',cal:145,prot:4,carb:26,fat:2,cat:'pilav'},
{name:'Domatesli Bulgur Pilavƒ±',emoji:'üçö',cal:90,prot:3,carb:18,fat:1,cat:'pilav'},
{name:'Firik Pilavƒ±',emoji:'üçö',cal:110,prot:4,carb:22,fat:1,cat:'pilav'},
{name:'Makarna (sade)',emoji:'üçù',cal:131,prot:5,carb:25,fat:1,cat:'pilav'},
{name:'Kƒ±ymalƒ± Makarna',emoji:'üçù',cal:160,prot:8,carb:18,fat:6,cat:'pilav'},
{name:'Fƒ±rƒ±nda Makarna',emoji:'üçù',cal:175,prot:8,carb:20,fat:7,cat:'pilav'},
{name:'Eri≈üte',emoji:'üçù',cal:138,prot:5,carb:25,fat:2,cat:'pilav'},
{name:'Mantƒ±',emoji:'ü•ü',cal:150,prot:7,carb:18,fat:5,cat:'pilav'},
{name:'Mantƒ± (yoƒüurtlu)',emoji:'ü•ü',cal:165,prot:8,carb:18,fat:7,cat:'pilav'},

// ‚îÄ‚îÄ HAMUR ƒ∞≈ûLERƒ∞ ‚îÄ‚îÄ
{name:'B√∂rek (ƒ±spanaklƒ±)',emoji:'ü•ß',cal:240,prot:7,carb:24,fat:13,cat:'hamur'},
{name:'Sigara B√∂reƒüi',emoji:'ü•ß',cal:280,prot:8,carb:22,fat:18,cat:'hamur'},
{name:'Kol B√∂reƒüi',emoji:'ü•ß',cal:255,prot:7,carb:25,fat:14,cat:'hamur'},
{name:'Tepsi B√∂reƒüi',emoji:'ü•ß',cal:245,prot:8,carb:24,fat:13,cat:'hamur'},
{name:'√áiƒü B√∂rek (√ßib√∂rek)',emoji:'ü•ü',cal:265,prot:10,carb:22,fat:15,cat:'hamur'},
{name:'ƒ∞√ßli K√∂fte',emoji:'ü•ü',cal:210,prot:8,carb:20,fat:11,cat:'hamur'},
{name:'Katmer',emoji:'ü•û',cal:350,prot:6,carb:30,fat:23,cat:'hamur'},
{name:'Yufka Ekmeƒüi',emoji:'ü´ì',cal:250,prot:8,carb:50,fat:2,cat:'hamur'},
{name:'Lava≈ü',emoji:'ü´ì',cal:275,prot:9,carb:50,fat:4,cat:'hamur'},
{name:'Pita Ekmeƒüi',emoji:'ü´ì',cal:275,prot:9,carb:55,fat:1,cat:'hamur'},

// ‚îÄ‚îÄ TATLILAR ‚îÄ‚îÄ
{name:'Baklava',emoji:'üçØ',cal:428,prot:6,carb:47,fat:24,cat:'tatli'},
{name:'K√ºnefe',emoji:'üçØ',cal:380,prot:8,carb:42,fat:20,cat:'tatli'},
{name:'S√ºtla√ß',emoji:'üçÆ',cal:120,prot:3,carb:20,fat:3,cat:'tatli'},
{name:'Kazandibi',emoji:'üçÆ',cal:140,prot:4,carb:22,fat:4,cat:'tatli'},
{name:'Ke≈ük√ºl',emoji:'üçÆ',cal:135,prot:3,carb:20,fat:5,cat:'tatli'},
{name:'Tavuk G√∂ƒüs√º (tatlƒ±)',emoji:'üçÆ',cal:125,prot:5,carb:19,fat:3,cat:'tatli'},
{name:'A≈üure',emoji:'üçÆ',cal:110,prot:3,carb:22,fat:1,cat:'tatli'},
{name:'Muhallebi',emoji:'üçÆ',cal:100,prot:3,carb:16,fat:3,cat:'tatli'},
{name:'Profiterol',emoji:'üç´',cal:350,prot:5,carb:35,fat:21,cat:'tatli'},
{name:'Supangle',emoji:'üç´',cal:180,prot:4,carb:25,fat:7,cat:'tatli'},
{name:'Revani',emoji:'üç∞',cal:290,prot:4,carb:45,fat:10,cat:'tatli'},
{name:'≈ûambali',emoji:'üç∞',cal:310,prot:4,carb:50,fat:11,cat:'tatli'},
{name:'Tulumba',emoji:'üç©',cal:350,prot:3,carb:42,fat:18,cat:'tatli'},
{name:'Lokma',emoji:'üç©',cal:330,prot:4,carb:40,fat:17,cat:'tatli'},
{name:'Lokum',emoji:'üç¨',cal:320,prot:0,carb:80,fat:0,cat:'tatli'},
{name:'Helva (tahin)',emoji:'üç¨',cal:516,prot:12,carb:55,fat:29,cat:'tatli'},
{name:'Helva (irmik)',emoji:'üç¨',cal:280,prot:3,carb:35,fat:15,cat:'tatli'},
{name:'G√ºlla√ß',emoji:'ü•õ',cal:160,prot:4,carb:28,fat:4,cat:'tatli'},
{name:'Dondurma (sade)',emoji:'üç¶',cal:207,prot:4,carb:24,fat:11,cat:'tatli'},
{name:'Dondurma (mara≈ü)',emoji:'üç¶',cal:190,prot:4,carb:22,fat:10,cat:'tatli'},
{name:'Kabak Tatlƒ±sƒ±',emoji:'üéÉ',cal:120,prot:1,carb:28,fat:0,cat:'tatli'},
{name:'Ayva Tatlƒ±sƒ±',emoji:'üçê',cal:150,prot:0,carb:38,fat:0,cat:'tatli'},
{name:'Trile√ße',emoji:'üç∞',cal:220,prot:5,carb:30,fat:9,cat:'tatli'},
{name:'San Sebastian Cheesecake',emoji:'üç∞',cal:320,prot:6,carb:22,fat:23,cat:'tatli'},
{name:'Waffle',emoji:'üßá',cal:291,prot:8,carb:33,fat:14,cat:'tatli'},

// ‚îÄ‚îÄ MEYVELER ‚îÄ‚îÄ
{name:'Elma',emoji:'üçé',cal:52,prot:0,carb:14,fat:0,cat:'meyve'},
{name:'Muz',emoji:'üçå',cal:89,prot:1,carb:23,fat:0,cat:'meyve'},
{name:'Portakal',emoji:'üçä',cal:47,prot:1,carb:12,fat:0,cat:'meyve'},
{name:'Mandalina',emoji:'üçä',cal:53,prot:1,carb:13,fat:0,cat:'meyve'},
{name:'√úz√ºm',emoji:'üçá',cal:69,prot:1,carb:18,fat:0,cat:'meyve'},
{name:'√áilek',emoji:'üçì',cal:32,prot:1,carb:8,fat:0,cat:'meyve'},
{name:'Kiraz',emoji:'üçí',cal:50,prot:1,carb:12,fat:0,cat:'meyve'},
{name:'Karpuz',emoji:'üçâ',cal:30,prot:1,carb:8,fat:0,cat:'meyve'},
{name:'Kavun',emoji:'üçà',cal:34,prot:1,carb:8,fat:0,cat:'meyve'},
{name:'≈ûeftali',emoji:'üçë',cal:39,prot:1,carb:10,fat:0,cat:'meyve'},
{name:'Kayƒ±sƒ±',emoji:'üü†',cal:48,prot:1,carb:11,fat:0,cat:'meyve'},
{name:'Erik',emoji:'üü£',cal:46,prot:1,carb:11,fat:0,cat:'meyve'},
{name:'Armut',emoji:'üçê',cal:57,prot:0,carb:15,fat:0,cat:'meyve'},
{name:'ƒ∞ncir (taze)',emoji:'üü§',cal:74,prot:1,carb:19,fat:0,cat:'meyve'},
{name:'Nar',emoji:'üî¥',cal:83,prot:2,carb:19,fat:1,cat:'meyve'},
{name:'Avokado',emoji:'ü•ë',cal:160,prot:2,carb:9,fat:15,cat:'meyve'},
{name:'Hurma',emoji:'üü§',cal:277,prot:2,carb:75,fat:0,cat:'meyve'},
{name:'Kuru Kayƒ±sƒ±',emoji:'üü†',cal:241,prot:3,carb:63,fat:1,cat:'meyve'},
{name:'Kuru ƒ∞ncir',emoji:'üü§',cal:249,prot:3,carb:64,fat:1,cat:'meyve'},
{name:'Kuru √úz√ºm',emoji:'üçá',cal:299,prot:3,carb:79,fat:0,cat:'meyve'},

// ‚îÄ‚îÄ KURUYEMI≈û ‚îÄ‚îÄ
{name:'Badem',emoji:'ü•ú',cal:579,prot:21,carb:22,fat:50,cat:'kuruyemis'},
{name:'Ceviz',emoji:'ü•ú',cal:654,prot:15,carb:14,fat:65,cat:'kuruyemis'},
{name:'Fƒ±ndƒ±k',emoji:'üå∞',cal:628,prot:15,carb:17,fat:61,cat:'kuruyemis'},
{name:'Fƒ±stƒ±k (Antep)',emoji:'ü•ú',cal:562,prot:20,carb:28,fat:45,cat:'kuruyemis'},
{name:'Yer Fƒ±stƒ±ƒüƒ±',emoji:'ü•ú',cal:567,prot:26,carb:16,fat:49,cat:'kuruyemis'},
{name:'Kaju',emoji:'ü•ú',cal:553,prot:18,carb:30,fat:44,cat:'kuruyemis'},
{name:'Ay√ßekirdeƒüi',emoji:'üåª',cal:584,prot:21,carb:20,fat:51,cat:'kuruyemis'},
{name:'Kabak √áekirdeƒüi',emoji:'üéÉ',cal:559,prot:30,carb:11,fat:49,cat:'kuruyemis'},
{name:'Kestane',emoji:'üå∞',cal:213,prot:3,carb:45,fat:2,cat:'kuruyemis'},
{name:'Leblebi',emoji:'üü§',cal:360,prot:22,carb:50,fat:7,cat:'kuruyemis'},

// ‚îÄ‚îÄ S√úT √úR√úNLERƒ∞ ‚îÄ‚îÄ
{name:'Yoƒüurt (tam yaƒülƒ±)',emoji:'ü•õ',cal:60,prot:5,carb:5,fat:2,cat:'sut'},
{name:'Yoƒüurt (light)',emoji:'ü•õ',cal:40,prot:5,carb:4,fat:0,cat:'sut'},
{name:'S√ºzme Yoƒüurt',emoji:'ü•õ',cal:95,prot:8,carb:4,fat:5,cat:'sut'},
{name:'Ayran',emoji:'ü•õ',cal:36,prot:2,carb:3,fat:2,cat:'sut'},
{name:'Kefir',emoji:'ü•õ',cal:55,prot:3,carb:4,fat:3,cat:'sut'},
{name:'S√ºt (tam yaƒülƒ±)',emoji:'ü•õ',cal:60,prot:3,carb:5,fat:3,cat:'sut'},
{name:'S√ºt (yarƒ±m yaƒülƒ±)',emoji:'ü•õ',cal:46,prot:3,carb:5,fat:2,cat:'sut'},
{name:'Labne',emoji:'üßÄ',cal:160,prot:6,carb:3,fat:14,cat:'sut'},

// ‚îÄ‚îÄ ƒ∞√áECEKLER ‚îÄ‚îÄ
{name:'√áay (≈üekersiz)',emoji:'üçµ',cal:1,prot:0,carb:0,fat:0,cat:'icecek'},
{name:'√áay (1 ≈üekerli)',emoji:'üçµ',cal:20,prot:0,carb:5,fat:0,cat:'icecek'},
{name:'T√ºrk Kahvesi',emoji:'‚òï',cal:12,prot:0,carb:2,fat:0,cat:'icecek'},
{name:'Filtre Kahve (sade)',emoji:'‚òï',cal:2,prot:0,carb:0,fat:0,cat:'icecek'},
{name:'Latte',emoji:'‚òï',cal:120,prot:6,carb:10,fat:6,cat:'icecek'},
{name:'Cappuccino',emoji:'‚òï',cal:80,prot:4,carb:6,fat:4,cat:'icecek'},
{name:'Portakal Suyu',emoji:'üßÉ',cal:45,prot:1,carb:10,fat:0,cat:'icecek'},
{name:'Limonata',emoji:'üçã',cal:40,prot:0,carb:10,fat:0,cat:'icecek'},
{name:'≈ûalgam Suyu',emoji:'ü•§',cal:10,prot:0,carb:2,fat:0,cat:'icecek'},
{name:'Kola',emoji:'ü•§',cal:42,prot:0,carb:11,fat:0,cat:'icecek'},
{name:'Kola (zero)',emoji:'ü•§',cal:0,prot:0,carb:0,fat:0,cat:'icecek'},
{name:'Soda',emoji:'ü•§',cal:0,prot:0,carb:0,fat:0,cat:'icecek'},
{name:'Boza',emoji:'ü•§',cal:65,prot:1,carb:14,fat:0,cat:'icecek'},
{name:'Salep',emoji:'ü•õ',cal:90,prot:2,carb:15,fat:3,cat:'icecek'},
{name:'T√ºrk Rakƒ±sƒ± (tek)',emoji:'ü•É',cal:214,prot:0,carb:0,fat:0,cat:'icecek'},
{name:'Bira (33cl)',emoji:'üç∫',cal:43,prot:0,carb:4,fat:0,cat:'icecek'},
{name:'≈ûarap (kƒ±rmƒ±zƒ±)',emoji:'üç∑',cal:85,prot:0,carb:3,fat:0,cat:'icecek'},

// ‚îÄ‚îÄ FAST FOOD & SOKAK LEZZETLERƒ∞ ‚îÄ‚îÄ
{name:'Hamburger',emoji:'üçî',cal:250,prot:13,carb:24,fat:12,cat:'fastfood'},
{name:'Cheeseburger',emoji:'üçî',cal:300,prot:15,carb:25,fat:15,cat:'fastfood'},
{name:'Pizza (1 dilim)',emoji:'üçï',cal:266,prot:11,carb:33,fat:10,cat:'fastfood'},
{name:'Patates Kƒ±zartmasƒ±',emoji:'üçü',cal:312,prot:3,carb:41,fat:15,cat:'fastfood'},
{name:'Tavuk Nugget',emoji:'üçó',cal:296,prot:15,carb:16,fat:19,cat:'fastfood'},
{name:'D√ºr√ºm (tavuk)',emoji:'üåØ',cal:160,prot:12,carb:14,fat:6,cat:'fastfood'},
{name:'D√ºr√ºm (et)',emoji:'üåØ',cal:175,prot:11,carb:15,fat:8,cat:'fastfood'},
{name:'Tost (ka≈üarlƒ±)',emoji:'ü•™',cal:280,prot:12,carb:26,fat:14,cat:'fastfood'},
{name:'Tost (karƒ±≈üƒ±k)',emoji:'ü•™',cal:310,prot:14,carb:25,fat:17,cat:'fastfood'},
{name:'Kumru',emoji:'ü•™',cal:290,prot:12,carb:28,fat:14,cat:'fastfood'},
{name:'Islak Hamburger',emoji:'üçî',cal:260,prot:11,carb:24,fat:13,cat:'fastfood'},
{name:'√áiƒü K√∂fte D√ºr√ºm',emoji:'üåØ',cal:130,prot:4,carb:22,fat:3,cat:'fastfood'},
{name:'Kumpir',emoji:'ü•î',cal:150,prot:4,carb:20,fat:6,cat:'fastfood'},
{name:'Midye Dolma (1 adet)',emoji:'üêö',cal:25,prot:1,carb:3,fat:1,cat:'fastfood'},
{name:'Waffle (√ßikolatalƒ±)',emoji:'üßá',cal:350,prot:7,carb:40,fat:18,cat:'fastfood'},

// ‚îÄ‚îÄ ATI≈ûTIMARIKLAR ‚îÄ‚îÄ
{name:'√áikolata (s√ºtl√º)',emoji:'üç´',cal:535,prot:8,carb:59,fat:30,cat:'atistirmalik'},
{name:'√áikolata (bitter)',emoji:'üç´',cal:546,prot:5,carb:60,fat:31,cat:'atistirmalik'},
{name:'Protein Bar',emoji:'üç´',cal:333,prot:33,carb:37,fat:12,cat:'atistirmalik'},
{name:'Granola Bar',emoji:'üç´',cal:400,prot:8,carb:60,fat:15,cat:'atistirmalik'},
{name:'Bisk√ºvi (sade)',emoji:'üç™',cal:440,prot:7,carb:70,fat:15,cat:'atistirmalik'},
{name:'Kraker',emoji:'üçò',cal:420,prot:10,carb:68,fat:12,cat:'atistirmalik'},
{name:'Cips',emoji:'ü•î',cal:536,prot:7,carb:50,fat:35,cat:'atistirmalik'},
{name:'Mƒ±sƒ±r (ha≈ülanmƒ±≈ü)',emoji:'üåΩ',cal:96,prot:3,carb:21,fat:1,cat:'atistirmalik'},
{name:'Popcorn (sade)',emoji:'üçø',cal:375,prot:12,carb:74,fat:4,cat:'atistirmalik'},
{name:'Kek (sade)',emoji:'üç∞',cal:350,prot:5,carb:50,fat:15,cat:'atistirmalik'},
{name:'Kurabiye',emoji:'üç™',cal:450,prot:5,carb:60,fat:22,cat:'atistirmalik'},
{name:'Gofret',emoji:'üç´',cal:490,prot:6,carb:58,fat:26,cat:'atistirmalik'},
];

const CATEGORIES = [
  {id:'all',name:'T√ºm√º',icon:''},
  {id:'kahvalti',name:'Kahvaltƒ±',icon:'üåÖ'},
  {id:'corba',name:'√áorba',icon:'üç≤'},
  {id:'et',name:'Et & Kebap',icon:'ü•©'},
  {id:'balik',name:'Balƒ±k',icon:'üêü'},
  {id:'sebze',name:'Sebze',icon:'ü•¨'},
  {id:'baklagil',name:'Baklagil',icon:'ü´ò'},
  {id:'pilav',name:'Pilav & Makarna',icon:'üçö'},
  {id:'hamur',name:'Hamur ƒ∞≈üi',icon:'ü•ß'},
  {id:'tatli',name:'Tatlƒ±',icon:'üçØ'},
  {id:'meyve',name:'Meyve',icon:'üçé'},
  {id:'kuruyemis',name:'Kuruyemi≈ü',icon:'ü•ú'},
  {id:'sut',name:'S√ºt √úr√ºn√º',icon:'ü•õ'},
  {id:'icecek',name:'ƒ∞√ßecek',icon:'üçµ'},
  {id:'fastfood',name:'Fast Food',icon:'üçî'},
  {id:'atistirmalik',name:'Atƒ±≈ütƒ±rmalƒ±k',icon:'üç´'},
];

const MEAL_DEFS = [
  {id:'kahvalti',name:'Kahvaltƒ±',icon:'üåÖ',color:'var(--orange)',colorLight:'var(--orange-light)'},
  {id:'ogle',name:'√ñƒüle Yemeƒüi',icon:'‚òÄÔ∏è',color:'var(--green)',colorLight:'var(--green-light)'},
  {id:'aksam',name:'Ak≈üam Yemeƒüi',icon:'üåô',color:'var(--blue)',colorLight:'var(--blue-light)'},
  {id:'atistirmalik',name:'Atƒ±≈ütƒ±rmalƒ±k',icon:'üçø',color:'var(--purple)',colorLight:'var(--purple-light)'},
];

// ========== STATE ==========
let dailyTarget=2200,protTarget=130,carbTarget=275,fatTarget=73;
let currentMealId=null,selectedCat='all',currentSource='local';
let currentDate=new Date(),pendingFood=null,deferredPrompt=null;
let apiSearchTimer=null;

// USDA API Key (free, demo key ‚Äî user should get their own for production)
const USDA_API_KEY = 'DEMO_KEY';

// ========== DATE ==========
function dateKey(d){const dd=d||currentDate;return `${dd.getFullYear()}-${String(dd.getMonth()+1).padStart(2,'0')}-${String(dd.getDate()).padStart(2,'0')}`}
function isToday(d){const t=new Date();return d.getFullYear()===t.getFullYear()&&d.getMonth()===t.getMonth()&&d.getDate()===t.getDate()}
function formatDateShort(d){const days=['Paz','Pzt','Sal','√áar','Per','Cum','Cmt'];const months=['Oca','≈ûub','Mar','Nis','May','Haz','Tem','Aƒüu','Eyl','Eki','Kas','Ara'];if(isToday(d))return'Bug√ºn';return`${d.getDate()} ${months[d.getMonth()]}, ${days[d.getDay()]}`}
function setHeaderDate(){const days=['Pazar','Pazartesi','Salƒ±','√áar≈üamba','Per≈üembe','Cuma','Cumartesi'];const months=['Ocak','≈ûubat','Mart','Nisan','Mayƒ±s','Haziran','Temmuz','Aƒüustos','Eyl√ºl','Ekim','Kasƒ±m','Aralƒ±k'];const d=new Date();document.getElementById('todayDate').textContent=`${days[d.getDay()]}, ${d.getDate()} ${months[d.getMonth()]}`}
function updateDateNav(){document.getElementById('navDate').textContent=formatDateShort(currentDate);document.getElementById('todayBtn').classList.toggle('show',!isToday(currentDate))}
function changeDate(delta){currentDate.setDate(currentDate.getDate()+delta);updateDateNav();renderMeals();updateHeader()}
function goToday(){currentDate=new Date();updateDateNav();renderMeals();updateHeader()}

// ========== STORAGE ==========
function getDayData(dk){const key=dk||dateKey();const raw=localStorage.getItem('vk_day_'+key);if(raw)return JSON.parse(raw);return{kahvalti:[],ogle:[],aksam:[],atistirmalik:[]}}
function saveDayData(dk,data){localStorage.setItem('vk_day_'+(dk||dateKey()),JSON.stringify(data))}
function saveProfile(){const p={gender:document.getElementById('pGender').value,age:document.getElementById('pAge').value,height:document.getElementById('pHeight').value,weight:document.getElementById('pWeight').value,activity:document.getElementById('pActivity').value,goal:document.getElementById('pGoal').value,dailyTarget,protTarget,carbTarget,fatTarget};localStorage.setItem('vk_profile',JSON.stringify(p))}
function loadProfile(){const raw=localStorage.getItem('vk_profile');if(!raw)return;const p=JSON.parse(raw);document.getElementById('pGender').value=p.gender||'male';document.getElementById('pAge').value=p.age||25;document.getElementById('pHeight').value=p.height||175;document.getElementById('pWeight').value=p.weight||75;document.getElementById('pActivity').value=p.activity||'1.375';document.getElementById('pGoal').value=p.goal||'0';if(p.dailyTarget)dailyTarget=p.dailyTarget;if(p.protTarget)protTarget=p.protTarget;if(p.carbTarget)carbTarget=p.carbTarget;if(p.fatTarget)fatTarget=p.fatTarget}

// ========== CALCULATIONS ==========
function getTotals(){const data=getDayData();let cal=0,prot=0,carb=0,fat=0;Object.values(data).forEach(foods=>foods.forEach(f=>{cal+=f.cal;prot+=f.prot;carb+=f.carb;fat+=f.fat}));return{cal:Math.round(cal),prot,carb,fat}}
function updateHeader(){const t=getTotals();const remain=Math.max(0,dailyTarget-t.cal);document.getElementById('calRemain').textContent=remain;const pct=Math.min(1,t.cal/dailyTarget);const circ=2*Math.PI*44;document.getElementById('calRing').style.strokeDashoffset=circ*(1-pct);document.getElementById('calRing').style.stroke=t.cal>dailyTarget?'#ff7070':'white';document.getElementById('protBar').style.width=Math.min(100,(t.prot/protTarget)*100)+'%';document.getElementById('carbBar').style.width=Math.min(100,(t.carb/carbTarget)*100)+'%';document.getElementById('fatBar').style.width=Math.min(100,(t.fat/fatTarget)*100)+'%';document.getElementById('protVal').textContent=Math.round(t.prot)+'g';document.getElementById('carbVal').textContent=Math.round(t.carb)+'g';document.getElementById('fatVal').textContent=Math.round(t.fat)+'g'}

// ========== RENDER MEALS ==========
function renderMeals(){const container=document.getElementById('mealsContainer');const data=getDayData();let html='';MEAL_DEFS.forEach(meal=>{const foods=data[meal.id]||[];const mealCal=Math.round(foods.reduce((s,f)=>s+f.cal,0));let fHTML='';if(!foods.length){fHTML='<div class="empty-meal">Hen√ºz yemek eklenmedi</div>'}else{foods.forEach((f,fi)=>{fHTML+=`<div class="food-item"><div class="food-emoji">${f.emoji||'üçΩÔ∏è'}</div><div class="food-info"><div class="food-name">${f.name}</div><div class="food-macros"><span>P:${Math.round(f.prot)}g</span><span>K:${Math.round(f.carb)}g</span><span>Y:${Math.round(f.fat)}g</span><span>‚Ä¢ ${Math.round(f.portionUsed||100)}g</span></div></div><div class="food-cal">${Math.round(f.cal)}</div><button class="food-delete" onclick="removeFood('${meal.id}',${fi})">‚úï</button></div>`})}html+=`<div class="meal-section"><div class="meal-header"><div class="meal-title"><div class="meal-icon" style="background:${meal.colorLight}">${meal.icon}</div>${meal.name}</div><div class="meal-kcal">${mealCal} kcal</div></div><div class="meal-card">${fHTML}<div class="add-food-btn" onclick="openAddFood('${meal.id}')">Ôºã Yemek Ekle</div></div></div>`});container.innerHTML=html}

// ========== FOOD MODAL ==========
function openAddFood(mealId){currentMealId=mealId;const meal=MEAL_DEFS.find(m=>m.id===mealId);document.getElementById('modalTitle').textContent=`${meal.icon} ${meal.name} ‚Äî Yemek Ekle`;document.getElementById('foodSearch').value='';selectedCat='all';currentSource='local';switchSource('local');renderCatPills();renderFoodDb();document.getElementById('addFoodModal').classList.add('show');setTimeout(()=>document.getElementById('foodSearch').focus(),300)}
function closeModal(){document.getElementById('addFoodModal').classList.remove('show')}

function switchSource(src){currentSource=src;document.querySelectorAll('.source-tab').forEach((t,i)=>t.classList.toggle('active',['local','api','custom'][i]===src));document.getElementById('localPanel').style.display=src==='local'?'block':'none';document.getElementById('apiPanel').style.display=src==='api'?'block':'none';document.getElementById('customPanel').style.display=src==='custom'?'block':'none';if(src==='api'){document.getElementById('apiResults').innerHTML='';document.getElementById('apiStatus').innerHTML='üåç ƒ∞ngilizce veya T√ºrk√ße yemek adƒ± yazƒ±p arayƒ±n';const q=document.getElementById('foodSearch').value.trim();if(q.length>=2)searchUSDA(q)}}

function renderCatPills(){document.getElementById('catPills').innerHTML=CATEGORIES.map(c=>`<button class="cat-pill ${c.id===selectedCat?'active':''}" onclick="filterCat('${c.id}')">${c.icon?c.icon+' ':''}${c.name}</button>`).join('')}
function filterCat(cat){selectedCat=cat;renderCatPills();renderFoodDb()}

function renderFoodDb(){const q=(document.getElementById('foodSearch').value||'').toLowerCase().trim();let filtered=FOOD_DB;if(selectedCat!=='all')filtered=filtered.filter(f=>f.cat===selectedCat);if(q)filtered=filtered.filter(f=>f.name.toLowerCase().includes(q));const list=document.getElementById('foodDbList');list.innerHTML=filtered.slice(0,30).map(f=>`<div class="food-db-item" onclick="selectDbFood('${f.name.replace(/'/g,"\\'")}')"><span class="fdb-emoji">${f.emoji}</span><div class="fdb-info"><div class="fdb-name">${f.name}</div><div class="fdb-detail">P:${f.prot}g K:${f.carb}g Y:${f.fat}g ‚Ä¢ 100g</div></div><div class="fdb-cal">${f.cal}</div></div>`).join('');if(!filtered.length)list.innerHTML='<div style="padding:16px;text-align:center;color:var(--text2);font-size:.82rem">Sonu√ß bulunamadƒ± ‚Äî USDA\'da aramayƒ± dene üåç</div>';document.getElementById('dbCount').textContent=`${filtered.length} / ${FOOD_DB.length} yemek`}

function handleSearch(){if(currentSource==='local')renderFoodDb();else if(currentSource==='api'){clearTimeout(apiSearchTimer);const q=document.getElementById('foodSearch').value.trim();if(q.length>=2){document.getElementById('apiStatus').innerHTML='<div class="spinner"></div><br>Aranƒ±yor...';apiSearchTimer=setTimeout(()=>searchUSDA(q),500)}}}

// ========== USDA API ==========
async function searchUSDA(query){try{const url=`https://api.nal.usda.gov/fdc/v1/foods/search?api_key=${USDA_API_KEY}&query=${encodeURIComponent(query)}&pageSize=15&dataType=Survey%20(FNDDS),Foundation,SR%20Legacy`;const res=await fetch(url);if(!res.ok)throw new Error('API error');const data=await res.json();const foods=data.foods||[];if(!foods.length){document.getElementById('apiStatus').innerHTML='Sonu√ß bulunamadƒ± üòï';document.getElementById('apiResults').innerHTML='';return}document.getElementById('apiStatus').style.display='none';const list=document.getElementById('apiResults');list.innerHTML=foods.map(f=>{const cal=getNutrient(f,1008);const prot=getNutrient(f,1003);const carb=getNutrient(f,1005);const fat=getNutrient(f,1004);const name=f.description.length>40?f.description.substring(0,40)+'...':f.description;return`<div class="food-db-item" onclick="selectApiFood(${JSON.stringify({name:f.description,cal,prot,carb,fat}).replace(/"/g,'&quot;')})"><span class="fdb-emoji">üåç</span><div class="fdb-info"><div class="fdb-name">${name}</div><div class="fdb-detail">P:${prot}g K:${carb}g Y:${fat}g ‚Ä¢ 100g</div></div><div class="fdb-cal">${cal}</div></div>`}).join('')}catch(e){document.getElementById('apiStatus').innerHTML='‚ö†Ô∏è API baƒülantƒ± hatasƒ±. ƒ∞nternet baƒülantƒ±nƒ±zƒ± kontrol edin.';document.getElementById('apiResults').innerHTML=''}}

function getNutrient(food,id){const n=food.foodNutrients?.find(n=>n.nutrientId===id||n.nutrientNumber===String(id));return n?Math.round(n.value||0):0}

function selectApiFood(f){pendingFood={name:f.name,emoji:'üåç',cal:f.cal,prot:f.prot,carb:f.carb,fat:f.fat,portion:100};closeModal();openPortionModal()}

// ========== PORTION MODAL ==========
function selectDbFood(name){pendingFood=FOOD_DB.find(f=>f.name===name);if(!pendingFood)return;pendingFood={...pendingFood,portion:100};closeModal();openPortionModal()}

function openPortionModal(){document.getElementById('portionEmoji').textContent=pendingFood.emoji;document.getElementById('portionFoodName').textContent=pendingFood.name;document.getElementById('portionFoodBase').textContent=`100g ba≈üƒ±na: ${pendingFood.cal} kcal`;document.getElementById('portionInput').value=100;updatePortionPreview();document.getElementById('portionModal').classList.add('show')}

function updatePortionPreview(){if(!pendingFood)return;const g=parseFloat(document.getElementById('portionInput').value)||0;const r=g/100;document.getElementById('portionPreview').innerHTML=`<span><div class="pv-val">${Math.round(pendingFood.cal*r)}</div>kcal</span><span><div class="pv-val">${Math.round(pendingFood.prot*r)}g</div>Protein</span><span><div class="pv-val">${Math.round(pendingFood.carb*r)}g</div>Karb</span><span><div class="pv-val">${Math.round(pendingFood.fat*r)}g</div>Yaƒü</span>`}

function confirmPortion(){if(!pendingFood||!currentMealId)return;const g=parseFloat(document.getElementById('portionInput').value)||100;const r=g/100;const food={name:pendingFood.name,emoji:pendingFood.emoji,cal:pendingFood.cal*r,prot:pendingFood.prot*r,carb:pendingFood.carb*r,fat:pendingFood.fat*r,portionUsed:g};const data=getDayData();data[currentMealId].push(food);saveDayData(null,data);closePortionModal();renderMeals();updateHeader();showToast(`‚úÖ ${food.name} (${Math.round(g)}g) eklendi!`)}

function closePortionModal(){document.getElementById('portionModal').classList.remove('show');pendingFood=null}

// ========== CUSTOM FOOD ==========
function addCustomFood(){const name=document.getElementById('customName').value.trim();const cal=parseFloat(document.getElementById('customCal').value)||0;const prot=parseFloat(document.getElementById('customProt').value)||0;const carb=parseFloat(document.getElementById('customCarb').value)||0;const fat=parseFloat(document.getElementById('customFat').value)||0;const portion=parseFloat(document.getElementById('customPortion').value)||100;if(!name){showToast('‚ö†Ô∏è Yemek adƒ± girin');return}if(!cal){showToast('‚ö†Ô∏è Kalori deƒüeri girin');return}const data=getDayData();data[currentMealId].push({name,emoji:'‚úèÔ∏è',cal,prot,carb,fat,portionUsed:portion});saveDayData(null,data);closeModal();renderMeals();updateHeader();showToast(`‚úÖ ${name} eklendi!`)}

function removeFood(mealId,idx){const data=getDayData();const rm=data[mealId].splice(idx,1)[0];saveDayData(null,data);renderMeals();updateHeader();showToast(`üóëÔ∏è ${rm.name} silindi`)}

// ========== STATS ==========
function renderStats(){const t=getTotals();const days=['Paz','Pzt','Sal','√áar','Per','Cum','Cmt'];const weekDays=[];for(let i=6;i>=0;i--){const d=new Date();d.setDate(d.getDate()-i);const dayData=getDayData(dateKey(d));let dayCal=0;Object.values(dayData).forEach(foods=>foods.forEach(f=>dayCal+=f.cal));weekDays.push({day:days[d.getDay()],cal:Math.round(dayCal),isToday:i===0})}const maxCal=Math.max(dailyTarget,...weekDays.map(d=>d.cal),100);document.getElementById('statsContainer').innerHTML=`<div class="stat-card"><h3>üìä Son 7 G√ºn</h3><div class="target-line"><span>Hedef: ${dailyTarget} kcal</span></div><div class="week-chart">${weekDays.map(d=>{const h=d.cal>0?Math.max(6,(d.cal/maxCal)*100):3;const cls=d.isToday?'today':d.cal===0?'empty':d.cal>dailyTarget?'over':'under';return`<div class="week-bar"><div class="cal-label">${d.cal>0?d.cal:'‚Äî'}</div><div class="bar ${cls}" style="height:${h}%"></div><div class="day-label">${d.day}</div></div>`}).join('')}</div></div><div class="stat-card" style="animation-delay:.05s"><h3>ü•ó Bug√ºnk√º Makrolar</h3><div class="macro-detail-grid"><div class="macro-detail-item" style="background:var(--red-light)"><div class="macro-circle" style="background:#ff7a7a;color:#fff">${Math.round(t.prot)}g</div><div class="md-name">Protein</div><div class="md-val">${protTarget}g hedef</div></div><div class="macro-detail-item" style="background:var(--orange-light)"><div class="macro-circle" style="background:#ffcc55;color:#7a5500">${Math.round(t.carb)}g</div><div class="md-name">Karbonhidrat</div><div class="md-val">${carbTarget}g hedef</div></div><div class="macro-detail-item" style="background:var(--blue-light)"><div class="macro-circle" style="background:#77bbff;color:#fff">${Math.round(t.fat)}g</div><div class="md-name">Yaƒü</div><div class="md-val">${fatTarget}g hedef</div></div></div></div><div class="stat-card" style="animation-delay:.1s"><h3>üéØ G√ºnl√ºk √ñzet</h3><div style="display:flex;justify-content:space-between;padding:8px 0"><span style="color:var(--text2);font-size:.82rem">Toplam</span><span style="font-weight:700">${t.cal} kcal</span></div><div style="display:flex;justify-content:space-between;padding:8px 0;border-top:1px solid #f5f2ed"><span style="color:var(--text2);font-size:.82rem">Hedef</span><span style="font-weight:700">${dailyTarget} kcal</span></div><div style="display:flex;justify-content:space-between;padding:8px 0;border-top:1px solid #f5f2ed"><span style="color:var(--text2);font-size:.82rem">Kalan</span><span style="font-weight:700;color:${t.cal>dailyTarget?'var(--red)':'var(--green)'}">${dailyTarget-t.cal} kcal</span></div></div>`}

// ========== TDEE ==========
function calculateTDEE(){const gender=document.getElementById('pGender').value;const age=parseInt(document.getElementById('pAge').value);const height=parseInt(document.getElementById('pHeight').value);const weight=parseInt(document.getElementById('pWeight').value);const activity=parseFloat(document.getElementById('pActivity').value);const goal=parseInt(document.getElementById('pGoal').value);let bmr;if(gender==='male')bmr=10*weight+6.25*height-5*age+5;else bmr=10*weight+6.25*height-5*age-161;const tdee=Math.round(bmr*activity+goal);dailyTarget=tdee;protTarget=Math.round((tdee*.30)/4);carbTarget=Math.round((tdee*.45)/4);fatTarget=Math.round((tdee*.25)/9);document.getElementById('tdeeNum').textContent=tdee;document.getElementById('calResult').classList.add('show');saveProfile();updateHeader();showToast(`üéØ G√ºnl√ºk hedef: ${tdee} kcal`)}

function resetAllData(){if(confirm('T√ºm verileriniz silinecek. Emin misiniz?')){Object.keys(localStorage).filter(k=>k.startsWith('vk_')).forEach(k=>localStorage.removeItem(k));location.reload()}}

// ========== TABS ==========
function switchTab(tab){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));document.getElementById('page-'+tab).classList.add('active');document.getElementById('nav-'+tab).classList.add('active');if(tab==='istatistik')renderStats()}

// ========== TOAST ==========
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');clearTimeout(t._timer);t._timer=setTimeout(()=>t.classList.remove('show'),2000)}

// ========== MODAL OVERLAYS ==========
document.getElementById('addFoodModal').addEventListener('click',e=>{if(e.target.id==='addFoodModal')closeModal()});
document.getElementById('portionModal').addEventListener('click',e=>{if(e.target.id==='portionModal')closePortionModal()});

// ========== PWA ==========
function setupPWA(){const manifest={name:"Vista Kalori - Beslenme Takibi",short_name:"Vista Kalori",description:"G√ºnl√ºk kalori ve beslenme takip uygulamasƒ±",start_url:location.href,display:"standalone",background_color:"#faf8f4",theme_color:"#e85d3a",orientation:"portrait",icons:[{src:"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect fill='%23e85d3a' width='512' height='512' rx='100'/><text x='256' y='340' text-anchor='middle' font-size='280'>üçΩ</text></svg>",sizes:"512x512",type:"image/svg+xml",purpose:"any maskable"}]};const blob=new Blob([JSON.stringify(manifest)],{type:'application/json'});document.getElementById('manifestLink').href=URL.createObjectURL(blob);if('serviceWorker' in navigator){const swCode=`const CACHE_NAME='vistakalori-v2';self.addEventListener('install',e=>{self.skipWaiting()});self.addEventListener('activate',e=>{e.waitUntil(caches.keys().then(n=>Promise.all(n.filter(n=>n!==CACHE_NAME).map(n=>caches.delete(n)))));self.clients.claim()});self.addEventListener('fetch',e=>{e.respondWith(fetch(e.request).catch(()=>caches.match(e.request)))})`;const swBlob=new Blob([swCode],{type:'application/javascript'});navigator.serviceWorker.register(URL.createObjectURL(swBlob)).catch(()=>{})}}

// ========== INIT ==========
setHeaderDate();loadProfile();updateDateNav();renderMeals();updateHeader();setupPWA();
</script>
</body>
</html>
